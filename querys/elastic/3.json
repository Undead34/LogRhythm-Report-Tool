{
  "id": "1d0ece15-8f1b-4c45-ae38-a9c1f06761ba",
  "name": "Análisis de Actividad de Inicio de Sesión y Prioridad",
  "description": "Esta consulta analiza la actividad de inicio de sesión dentro del rango de fechas especificado para las entidades con ID 16 o 4. Se agrupan los resultados por el campo de `login` y se calculan las siguientes métricas:\n- Promedio de la prioridad (`priority`) de los eventos.\n- Cardinalidad (número único) de `userOriginIdentityName`.\n- Cardinalidad (número único) de `userOriginIdentityTitle`.\n- Cardinalidad (número único) de `logSourceName`.\n- Cardinalidad (número único) de `mpeRuleName`.\n- Máximo valor de la prioridad (`priority`) de los eventos.",
  "mode": "single",
  "index": ["logs-*"],
  "aggregation_result": true,
  "type": "2",
  "query": {
    "aggs": {
      "4": {
        "terms": {
          "field": "login",
          "size": 20,
          "order": {
            "_count": "desc"
          }
        },
        "aggs": {
          "3": {
            "avg": {
              "field": "priority"
            }
          },
          "5": {
            "cardinality": {
              "field": "userOriginIdentityName"
            }
          },
          "6": {
            "cardinality": {
              "field": "userOriginIdentityTitle"
            }
          },
          "7": {
            "cardinality": {
              "field": "logSourceName"
            }
          },
          "8": {
            "cardinality": {
              "field": "mpeRuleName"
            }
          },
          "9": {
            "max": {
              "field": "priority"
            }
          }
        }
      }
    },
    "size": 0,
    "_source": {
      "excludes": []
    },
    "stored_fields": ["*"],
    "script_fields": {},
    "docvalue_fields": [
      {
        "field": "insertedDate",
        "format": "date_time"
      },
      {
        "field": "logDate",
        "format": "date_time"
      },
      {
        "field": "normalDate",
        "format": "date_time"
      }
    ],
    "query": {
      "bool": {
        "must": [
          {
            "query_string": {
              "query": "{{entity_ids}}",
              "analyze_wildcard": true,
              "default_field": "*"
            }
          },
          {
            "match_all": {}
          },
          {
            "range": {
              "normalDate": {
                "gte": "{{gte}}",
                "lte": "{{lte}}",
                "format": "epoch_millis"
              }
            }
          }
        ],
        "filter": [],
        "should": [],
        "must_not": []
      }
    }
  }
}
