{
  "id": "40d28fac-063b-4540-8b5a-bf663f232527",
  "name": "Distribución de Tipos de Fuente de Mensaje",
  "description": "Esta consulta agrega los documentos en el índice `logs-*` por el campo `msgSourceTypeName`, mostrando los tipos de dispositivos que envían los registros. Se enfoca en documentos donde `isEvent` es verdadero y los agrupa por `entityId` dentro del rango de fechas especificado. Los resultados se ordenan en orden descendente por la cantidad de documentos por tipo de fuente, limitados a los 200 tipos más comunes.",
  "mode": "single",
  "index": ["logs-*"],
  "aggregation_result": true,
  "type": "1",
  "query": {
    "aggs": {
      "3": {
        "terms": {
          "field": "msgSourceTypeName",
          "size": 200,
          "order": { "_count": "desc" }
        }
      }
    },
    "size": 0,
    "_source": { "excludes": [] },
    "stored_fields": ["*"],
    "script_fields": {},
    "docvalue_fields": [
      { "field": "insertedDate", "format": "date_time" },
      { "field": "logDate", "format": "date_time" },
      { "field": "normalDate", "format": "date_time" }
    ],
    "query": {
      "bool": {
        "must": [
          {
            "range": {
              "normalDate": {
                "gte": "{{gte}}",
                "lte": "{{lte}}",
                "format": "epoch_millis"
              }
            }
          }
        ],
        "filter": [
          {
            "bool": {
              "filter": [
                {
                  "bool": {
                    "should": [
                      {
                        "bool": {
                          "should": [
                            { "match": { "entityId": "{{entity_ids}}" } }
                          ],
                          "minimum_should_match": 1
                        }
                      }
                    ],
                    "minimum_should_match": 1
                  }
                },
                {
                  "bool": {
                    "should": [{ "match": { "isEvent": true } }],
                    "minimum_should_match": 1
                  }
                }
              ]
            }
          }
        ],
        "should": [],
        "must_not": []
      }
    },
    "timeout": "30000ms"
  }
}
